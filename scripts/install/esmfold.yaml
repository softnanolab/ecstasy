name: esmfold
channels:
  - pytorch          # GPU-enabled PyTorch 1.12.1 + cu113
  - defaults         # provides intel-openmp 2023.1.0
  - conda-forge
  - bioconda

dependencies:
  # --- core toolchain & CUDA -------------------------------------------------
  - python=3.7
  - setuptools=59.5.0
  - pip
  - cudatoolkit=11.3          # runtime
  - cudatoolkit-dev=11.3      # headers & nvcc stubs (for OpenFold build)
  - pytorch=1.12.1            # pulls the cu113 build from the pytorch channel

  # run-time OpenMP / ITT libraries EXACTLY as PyTorch 1.12 expects
  - defaults::intel-openmp=2023.1.0      # libiomp5.so + libittnotify.so

  # GCC ≤10 for CUDA 11.3, plus glibc/sysroot
  - gcc_linux-64=9.5.0
  - gxx_linux-64=9.5.0
  - sysroot_linux-64=2.17

  # CMake & Ninja — OpenFold’s CUDA extension and Deepspeed need them
  - cmake>=3.26
  - ninja

  # --- scientific / bio dependencies ----------------------------------------
  - openmm=7.5.1
  - pdbfixer
  - einops=0.6.1
  - fairscale
  - omegaconf
  - hydra-core
  - pandas
  - pytest
  - hmmer=3.3.2
  - hhsuite=3.3.0
  - kalign2=2.04
  - jupyter

  # --------------------------------------------------------------------------
  # Everything below this line is installed with pip to match the versions
  # you’ve been using.  Leaving them here keeps the conda solve fast.
  # --------------------------------------------------------------------------
  - pip:
      - biopython==1.79
      - deepspeed==0.5.9
      - dm-tree==0.1.6
      - ml-collections==0.1.0
      - numpy==1.21.2
      - PyYAML==5.4.1
      - requests==2.26.0
      - scipy==1.7.1
      - tqdm==4.62.2
      - typing-extensions==3.10.0.2
      - pytorch_lightning==1.5.10
      - wandb==0.12.21
      - biotite==0.39.0
      - matplotlib
      - joblib
      - git+https://github.com/NVIDIA/dllogger.git